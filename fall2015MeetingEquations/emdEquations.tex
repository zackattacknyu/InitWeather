%%
%% Class homework & solution template for latex
%% Alex Ihler
%%
\documentclass[twoside,11pt]{article}
\usepackage{amsmath,amsfonts,amssymb,amsthm}
\usepackage{graphicx,color}
\usepackage{verbatim,url}
\usepackage{listings}
\usepackage{upquote}
\usepackage[T1]{fontenc}
%\usepackage{lmodern}
\usepackage[scaled]{beramono}
%\usepackage{textcomp}

% Directories for other source files and images
\newcommand{\bibtexdir}{../bib}
\newcommand{\figdir}{fig}

\newcommand{\E}{\mathrm{E}}
\newcommand{\Var}{\mathrm{Var}}
\newcommand{\N}{\mathcal{N}}
\newcommand{\matlab}{{\sc Matlab}\ }

\setlength{\textheight}{9in} \setlength{\textwidth}{6.5in}
\setlength{\oddsidemargin}{-.25in}  % Centers text.
\setlength{\evensidemargin}{-.25in} %
\setlength{\topmargin}{0in} %
\setlength{\headheight}{0in} %
\setlength{\headsep}{0in} %

\renewcommand{\labelenumi}{(\alph{enumi})}
\renewcommand{\labelenumii}{(\arabic{enumii})}

\theoremstyle{definition}
\newtheorem{MatEx}{M{\scriptsize{ATLAB}} Usage Example}

\definecolor{comments}{rgb}{0,.5,0}
\definecolor{backgnd}{rgb}{.95,.95,.95}
\definecolor{string}{rgb}{.2,.2,.2}
\lstset{language=Matlab}
\lstset{basicstyle=\small\ttfamily,
        mathescape=true,
        emptylines=1, showlines=true,
        backgroundcolor=\color{backgnd},
        commentstyle=\color{comments}\ttfamily, %\rmfamily,
        stringstyle=\color{string}\ttfamily,
        keywordstyle=\ttfamily, %\normalfont,
        showstringspaces=false}
\newcommand{\matp}{\mathbf{\gg}}




\begin{document}

Target patch has pixels $x_{ij}$\\
\[
\begin{bmatrix}
    x_{11} & x_{12} & x_{13} & \dots  & x_{1n} \\
    x_{21} & x_{22} & x_{23} & \dots  & x_{2n} \\
    \vdots & \vdots & \vdots & \ddots & \vdots \\
    x_{m1} & x_{m2} & x_{m3} & \dots  & x_{mn}
\end{bmatrix}
\]

Prediction patch has pixels $\hat{x_{kl}}$\\
\[
\begin{bmatrix}
    \hat{x_{11}} & \hat{x_{12}} & \hat{x_{13}} & \dots  & \hat{x_{1n}} \\
    \hat{x_{21}} & \hat{x_{22}} & \hat{x_{23}} & \dots  & \hat{x_{2n}} \\
    \vdots & \vdots & \vdots & \ddots & \vdots \\
    \hat{x_{m1}} & \hat{x_{m2}} & \hat{x_{m3}} & \dots  & \hat{x_{mn}}
\end{bmatrix}
\]
Without loss of generality, 
\[
\sum_{kl}{\hat{x}_{kl}} \leq \sum_{ij}{x_{ij}}
\]
Let $c_{ijkl} = \sqrt{(i-k)^2 + (j-l)^2}$ \\
Let $f$ be a flow vector where entry $f_{ijkl}$ represents the flow from pixel $x_{ij}$ to pixel $\hat{x_{kl}}$\\
\[
WORK = \min_f(\sum_{ij}{\sum_{kl}{c_{ijkl} f_{ijkl}}} + \alpha \sum_{ij}{(x_{ij} - \sum_{kl}{f_{ijkl}})^2})
\]
subject to the following constraints:\\
\[
f_{ijkl} \geq 0 \, \, \forall ijkl
\]
\[
\sum_{ij}{f_{ijkl}} = \hat{x}_{kl} \, \, \forall kl
\]
\[
\sum_{kl}{f_{ijkl}} \leq x_{ij} \, \, \forall ij
\]
Earth-Movers Distance is defined as follows:
\[
EMD = \frac{WORK}{\sum_{kl}{\hat{x}_{kl}}}
\]


\end{document}
